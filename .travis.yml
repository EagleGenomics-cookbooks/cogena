sudo: required
dist: trusty

addons:
  apt:
    sources:
    - chef-stable-trusty
    packages:
    - chefdk

install: echo "skip bundle install"

branches:
  only:
  - master

services: docker

env:
  global:
  - RUBYOPT="-W0"
  matrix:
  - CHEF_VERSION=current INSTANCE=default-ubuntu-1404

before_script:
- sudo iptables -L DOCKER || ( echo "DOCKER iptables chain missing" ; sudo iptables
  -N DOCKER )
- eval "$(/opt/chefdk/bin/chef shell-init bash)"
- chef gem install kitchen-docker
- "/opt/chefdk/bin/chef exec rake tests"

script:
- KITCHEN_LOCAL_YAML=.kitchen.docker.yml /opt/chefdk/embedded/bin/kitchen verify ${INSTANCE}

notifications:
  slack:
    on_success: change
    on_failure: change
    rooms:
      secure: M9SbZUxzewyr1yJo5lbmd1Kzbt4UfY8wG9hyHm5NmJOrF5EgxlYt8Epdx6FCuELPov63Mp04nv6r2lq5+8MN7FziO06kpMPHdQFhfPXvUie5oD2cN552xEwn4hN/vH90HAKuYus/L87FXYcuQFWLgCJf+G7sqK6rPXQiV9yo+cr4Sy8YPqYlC76YrwBQwgQ36WkQ7SmqNgyAQWqsDrjYwLVJoiVGToJqxxnBslKD9yHGuLxl2B22VTwmVXnfyB2yRKs/9fsGZ7b22FUeuAdznsLUBM0Kjz+apcoIGXchGKTLcHtlogw+PwjJS8JuLZ1FiQOlF8Ohq2cVJcK66wi5GYSocA1DWLTnG7PWEsSwJSPSfr8brYFZJmzU4g+WgXcb8v8Y8gv0+OpwgbizO571WvFazfYzbxMq+JsGqzn2soHivCCVs6PrI7kfRKD5ojYKFWQJC9U2xFiMSMUWMuq6PvJgqZ/BY/7s0K8PmcHXDaI82Ua1mBe+D+vPJT1Nab4isrfT3YZOnv8QHBbPdJwZZHr2Amwd/mgUK/jEIMR1iTrKwdRFrehgHLOsA9pWg8xo7IF4qAJmu0lR4axPeMwLF0en4sNfJ8QjXf4aEEbBBGaf2ThRAnnTf4tPUm7WjZNLhCFFJa5Vc9PWtZZvMsiKD83xECmP3/4hOxiZi077iS8=
  email:
    on_success: change
    on_failure: change
